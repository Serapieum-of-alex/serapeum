%% Sequence Diagram: Structured Output Generation
sequenceDiagram
  autonumber
  actor User
  participant L as LLM
  participant PT as PromptTemplate
  participant O as Ollama
  participant PJ as JSON Validator
  participant PM as Pydantic Model

  User->>L: parse(schema, prompt=PromptTemplate, llm_kwargs)
  activate L
  L->>PT: format()
  PT-->>L: formatted prompt
  L->>L: build JSON schema from schema
  note over L: Program creation for LLM
  L->>O: complete(prompt) or chat(messages)
  O-->>L: raw JSON string
  L->>PJ: validate JSON against schema
  PJ-->>L: validated JSON
  L->>PM: instantiate schema(**json)
  PM-->>L: model instance
  L-->>User: Pydantic model instance
  deactivate L
