name: Release Package

on:
  workflow_dispatch:
    inputs:
      package:
        description: 'Package to release'
        required: true
        type: choice
        options:
          - serapeum-ollama
          - serapeum-core
      increment:
        description: 'Version increment type'
        required: true
        type: choice
        options:
          - patch
          - minor
          - major
        default: patch
      prerelease-type:
        description: 'Prerelease type (none for a stable release)'
        required: false
        type: choice
        options:
          - none
          - alpha
          - beta
          - rc
        default: none
      draft:
        description: 'Create as draft release'
        type: boolean
        default: false

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Resolve package path
        run: |
          case "${{ inputs.package }}" in
            serapeum-ollama) echo "PACKAGE_PATH=libs/providers/ollama" >> $GITHUB_ENV ;;
            serapeum-core)   echo "PACKAGE_PATH=libs/core"             >> $GITHUB_ENV ;;
          esac

      - name: Create GitHub Release
        uses: Serapieum-of-alex/github-actions/actions/release/github@main
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          release-branch: main
          increment: ${{ inputs.increment }}
          prerelease-type: ${{ inputs.prerelease-type }}
          draft: ${{ inputs.draft }}
          package-manager: uv
          python-version: '3.12'
          install-groups: 'groups: docs dev'
          config-file: ${{ env.PACKAGE_PATH }}/pyproject.toml
